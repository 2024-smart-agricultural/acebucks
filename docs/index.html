<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>농산물 가격 모니터링</title>
  <style>
    table {
      width: 100%;
      border-collapse: collapse;
    }
    table, th, td {
      border: 1px solid black;
    }
    th, td {
      padding: 8px;
      text-align: left;
    }
  </style>
</head>
<body>
  <h1>일별 농산물 가격</h1>
  <div id="daily-prices"></div>

  <script>
    async function fetchAndDisplayDailyPrices(filename, containerId, mappingFilename) {
      try {
         // 매핑 정보 불러오기
        const mappingResponse = await fetch(mappingFilename);
        const mappings = await mappingResponse.json();

        const itemCategoryMapping = mappings.item_category_mapping;
        const itemMapping = mappings.item_mapping;
        const productRankMapping = mappings.product_rank_mapping;

        // 가격 정보 불러오기
        const response = await fetch(filename);
        const data = await response.json();
        const container = document.getElementById(containerId);

        // 테이블 생성
        let table = document.createElement('table');
        let thead = document.createElement('thead');
        let tbody = document.createElement('tbody');

        // 테이블 헤더 생성
        let headerRow = document.createElement('tr');
        let headers = ['시작일', '종료일', '항목 코드', '항목 이름', '품목 코드', '품목 이름', '등급 코드', '등급 이름', '가격 (원)'];
        headers.forEach(header => {
          let th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        // 데이터 생성
        const condition = data.condition[0];
        const price = data.data[0];

        // 각 코드에 대한 이름 매핑
        let itemCategoryName = itemCategoryMapping[condition.p_itemcategorycode] || '알 수 없음';
        let itemName = itemMapping[condition.p_itemcode] || '알 수 없음';
        let productRankName = productRankMapping[condition.p_productrankcode] || '알 수 없음';

        let row = document.createElement('tr');
        let cells = [
          condition.p_startday,
          condition.p_endday,
          condition.p_itemcategorycode,
          itemCategoryName,
          condition.p_itemcode,
          itemName,
          condition.p_productrankcode,
          productRankName,
          price
        ];

        cells.forEach(cell => {
          let td = document.createElement('td');
          td.textContent = cell;
          row.appendChild(td);
        });

        tbody.appendChild(row);
        table.appendChild(thead);
        table.appendChild(tbody);
        container.appendChild(table);

      } catch (error) {
        console.error("데이터를 가져오거나 표시하는 중 오류가 발생했습니다:", error);
      }
    }

    // 파일 경로를 사용해 데이터를 가져와 테이블로 표시
    fetchAndDisplayDailyPrices('./daily_product_prices_2024-10-31.json', 'daily-prices');
  </script>
</body>
<body>
  <h1>지역별 농산물 가격</h1>
  <div id="regional-prices"></div>

  <script>
    async function fetchAndDisplayRegionalPrices(priceFilename, containerId, mappingFilename) {
      try {
        // 매핑 파일을 불러와서 품목, 항목, 등급 이름을 얻기
        const mappingResponse = await fetch(mappingFilename);
        const mappings = await mappingResponse.json();

        const itemCategoryMapping = mappings.item_category_mapping;
        const itemMapping = mappings.item_mapping;
        const productRankMapping = mappings.product_rank_mapping;

        // 가격 데이터 불러오기
        const response = await fetch(priceFilename);
        const data = await response.json();
        const container = document.getElementById(containerId);

        // 테이블 생성
        let table = document.createElement('table');
        let thead = document.createElement('thead');
        let tbody = document.createElement('tbody');

        // 테이블 헤더 생성
        let headerRow = document.createElement('tr');
        let headers = ['항목 이름', '품목 이름', '등급 이름', '날짜', '가격 (원)'];
        headers.forEach(header => {
          let th = document.createElement('th');
          th.textContent = header;
          headerRow.appendChild(th);
        });
        thead.appendChild(headerRow);

        // 데이터 생성
        const condition = data.condition[0];
        const price = data.data[0];

        // 각 코드 값을 이름으로 매핑
        let itemCategoryName = itemCategoryMapping[condition.p_itemcategorycode] || '알 수 없음';
        let itemName = itemMapping[condition.p_itemcode] || '알 수 없음';
        let productRankName = productRankMapping[condition.p_productrankcode] || '알 수 없음';

        // 테이블 행 추가
        let row = document.createElement('tr');
        let cells = [
          itemCategoryName,
          itemName,
          productRankName,
          condition.p_regday,
          price
        ];

        cells.forEach(cell => {
          let td = document.createElement('td');
          td.textContent = cell;
          row.appendChild(td);
        });

        tbody.appendChild(row);
        table.appendChild(thead);
        table.appendChild(tbody);
        container.appendChild(table);

      } catch (error) {
        console.error("데이터를 가져오거나 표시하는 중 오류가 발생했습니다:", error);
      }
    }

    // 파일 경로를 사용해 데이터를 가져와 테이블로 표시
    fetchAndDisplayRegionalPrices('./regional_product_prices_2024-10-31.json', 'regional-prices', './data/code_mappings.json');
  </script>
</body>
</html>
